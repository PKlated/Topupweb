@{
    ViewData["Title"] = "Payment History";
    Layout = "~/Views/Shared/_Layout.navbar.cshtml";

    // TEMP MOCK DATA (replace with DB later)
    var payments = new[]
    {
        new { Id = 1, Date = "2026-01-10", Package = "100 Gems", Amount = 49, Status = "Success" },
        new { Id = 2, Date = "2026-01-15", Package = "500 Gems", Amount = 199, Status = "Success" },
        new { Id = 3, Date = "2026-01-20", Package = "1000 Gems", Amount = 399, Status = "Pending" }
    };

    var totalSpent = payments
        .Where(p => p.Status == "Success")
        .Sum(p => p.Amount);

    var totalTransactions = payments.Length;
    var successCount = payments.Count(p => p.Status == "Success");
}

<!-- PAGE HEADER -->
<div class="bg-white border-4 border-black shadow-[6px_6px_0_#000] p-6 mb-8">
    <h1 class="text-3xl font-extrabold tracking-wide mb-2">
        PAYMENT HISTORY
    </h1>
    <p class="text-sm text-gray-700">
        View your past top-ups and payment statistics.
    </p>
</div>

@if (!User.Identity.IsAuthenticated)
{
    <!-- GUEST BLOCK -->
    <div class="bg-[#FFFBCC] border-4 border-black shadow-[4px_4px_0_#000] p-5">
        <p class="font-extrabold mb-2">⚠ Login Required</p>
        <p class="text-sm mb-4">
            Please login to view your payment history.
        </p>

        <a asp-controller="Auth" asp-action="Login"
           class="inline-block px-4 py-2 border-2 border-black bg-white
                  shadow-[2px_2px_0_#000] font-bold">
            LOGIN
        </a>
    </div>
}
else
{
    <!-- STATS -->
    <div class="grid md:grid-cols-3 gap-6 mb-8">

        <div class="bg-white border-4 border-black shadow-[4px_4px_0_#000] p-5">
            <p class="text-sm text-gray-600">Total Spent</p>
            <p class="text-2xl font-extrabold">฿@totalSpent</p>
        </div>

        <div class="bg-white border-4 border-black shadow-[4px_4px_0_#000] p-5">
            <p class="text-sm text-gray-600">Total Transactions</p>
            <p class="text-2xl font-extrabold">@totalTransactions</p>
        </div>

        <div class="bg-white border-4 border-black shadow-[4px_4px_0_#000] p-5">
            <p class="text-sm text-gray-600">Successful Payments</p>
            <p class="text-2xl font-extrabold">@successCount</p>
        </div>

    </div>

    <!-- PAYMENT TABLE -->
    <div class="bg-white border-4 border-black shadow-[6px_6px_0_#000] overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-gray-100 border-b-4 border-black">
                <tr>
                    <th class="p-3 text-left font-extrabold">Date</th>
                    <th class="p-3 text-left font-extrabold">Package</th>
                    <th class="p-3 text-left font-extrabold">Amount</th>
                    <th class="p-3 text-left font-extrabold">Status</th>
                    <th class="p-3 text-left font-extrabold">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in payments)
                {
                    <tr class="border-b-2 border-black">
                        <td class="p-3">@p.Date</td>
                        <td class="p-3 font-bold">@p.Package</td>
                        <td class="p-3">฿@p.Amount</td>
                        <td class="p-3">
                            @if (p.Status == "Success")
                            {
                                <span class="px-2 py-1 border-2 border-black bg-[#4CAF50] text-white font-bold">
                                    SUCCESS
                                </span>
                            }
                            else if (p.Status == "Pending")
                            {
                                <span class="px-2 py-1 border-2 border-black bg-yellow-400 font-bold">
                                    PENDING
                                </span>
                            }
                            else
                            {
                                <span class="px-2 py-1 border-2 border-black bg-red-500 text-white font-bold">
                                    FAILED
                                </span>
                            }
                        </td>
                        <td class="p-3">
                            <a asp-controller="User"
                               asp-action="PaymentRemaining"
                               asp-route-id="@p.Id"
                               class="px-3 py-1 border-2 border-black bg-white
                                      shadow-[2px_2px_0_#000]
                                      hover:translate-x-[1px]
                                      hover:translate-y-[1px]
                                      hover:shadow-none
                                      font-bold text-xs">
                                @(p.Status == "Pending" ? "RESUME" : "DETAILS")
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
